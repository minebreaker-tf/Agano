======================================================================
        IP Messenger for Win 全ソース 取り扱い説明書    2016/04/03

                                               H.Shirouzu（白水啓章）
                                               http://ipmsg.org
======================================================================

目次

  1. 概要
  2. 使用上の注意
  3. サポートについて
  4. コンパイル方法
  5. ディレクトリ構成
  6. 自己展開インストーラ形式について

■ 1. 概要

・IP Messenger for Win の全ソースコードです。

・MFC を使用せず、オリジナルの簡易クラスライブラリを使っています。
  簡易クラス部分は、tlib.h と t*.cpp になります。

・VS2015以降 でビルドできます。


■ 2. 使用上の注意

・「IP Messenger for Win」は実行ファイル・ソースコード共に
  フリーソフトウェアです。

・アーカイブの転載・再配布は自由です。

・ライセンスは以下の通りです。(BSD License)

/* ==============================================================
  Copyright (c) 1996-2016 SHIROUZU Hiroaki  All rights reserved.

  ソースとバイナリ形式の再配布および使用は、「変更の有無、商用/
  非商用にかかわらず」、以下の条件を満たす場合に許可されます:

  1. ソースコード形式で再配布する場合、上記著作権表示、本条件書、
     および下記免責表示を必ず含めてください。

  2. バイナリ形式で再配布する場合、上記著作権表示、本条件書、
     および下記免責表示を、配布物とともに提供される文書及び
     他の資料に必ず含めてください。

 「このソフトウエアは、作者により「あるがままの状態」で提供され、
   あらゆる明示的または暗黙の保証を否認し、いかなる損害に対しても
   責任を負いません。」

=============================================================== */


■ 3. サポートについて

・サポートは下記のURLに記載している掲示板で行っています。
　また、次期バージョンへ向けての提案なども歓迎です。
 （最新版は常にここにあります）。
    http://ipmsg.org/

・潜在バグの指摘や、よりよいソースコードへのアドバイスを歓迎します。


■ 4. コンパイル方法（VS2015以降）

  VS2015以降でビルドします。
　（3.50b7以降、libpng は利用しなくなりました。zlib はインストーラ
　　のみで利用しています。本体には組み込まれていません）


■ 5. ディレクトリ構成

	IPMsg----+-IPMsg.sln ... Project file for VS2015以降
		|
		+-Src------+-ipmsg.cpp
		|          |     :
		|          +-install-+- install.cpp
		|                    |       :
		|
		+-external-+-zlib (for installer)
		|
		+-Lib
		|
		+-Release--+-
		|
		+-Obj------+-Release-+-
		|          |
		|          +-Debug---+-
		|
		+-x64---+-Release
		        |
		        +-obj---+-Relase
		                |   :

■ 6. 自己展開インストーラ形式について

・v3.10より、自己展開形式インストーラをサポートしています。
　これはソースよりビルドされた install.exe の末尾に、以下のような
　フォーマットで、ipmsg.exe setup.exe ipmsg.chm を付加したものです。
　 \n===(70個)===\n
　 ファイルサイズ ファイル名\n
　 ZLIB圧縮ファイル

・具体的には、以下のような python script で作成しています。

----------------------------------------------------
import sys, zlib

def add_file(f, fname):
	data = zlib.compress(open(fname, "rb").read())
	f.write("\n%s\n" % ("=" * 70))
	f.write("%d %s\n" % (len(data), fname))
	f.write(data)

def gen_inst(installer_name, installer_base, files):
	f = open(installer_name, "wb")
	f.write(open(installer_base, "rb").read())
	for i in files:
		add_file(f, i)
	f.close()

gen_inst("ipmsgXXX_installer.exe", "install.exe", ["ipmsg.exe", "ipmsg.chm", "setup.exe"])
----------------------------------------------------

